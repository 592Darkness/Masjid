document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".hamburger"),e=document.querySelector("nav ul");t&&e?t.addEventListener("click",function(){e.classList.toggle("show"),console.log("Hamburger toggled:",e.classList.contains("show"))},{passive:!0}):console.warn("Hamburger or nav menu not found");const a=document.querySelector(".theme-toggle"),n=document.body;if(a){const t=localStorage.getItem("theme"),e=window.matchMedia("(prefers-color-scheme: dark)");"dark"===t||!t&&e.matches?(n.classList.add("dark-theme"),console.log("Applied saved dark theme or system preference")):console.log("No saved theme or light theme applied"),a.addEventListener("click",function(){n.classList.toggle("dark-theme");const t=n.classList.contains("dark-theme");localStorage.setItem("theme",t?"dark":"light"),console.log("Theme toggled to:",t?"dark":"light")},{passive:!0})}else console.error("Theme toggle button not found");async function r(){try{const t=(new Date).toISOString().split("T")[0],e=localStorage.getItem(`prayer_times_${t}`);if(e)return console.log("Using cached prayer times"),void o(JSON.parse(e));const a=new AbortController,r=setTimeout(()=>a.abort(),5e3);console.log("Fetching prayer times with lat/long");const c=await fetch(`https://api.aladhan.com/v1/timings/${t}?latitude=6.8061&longitude=-58.1817&method=2`,{signal:a.signal});if(clearTimeout(r),!c.ok)throw new Error("Prayer API response not OK");const i=await c.json();localStorage.setItem(`prayer_times_${t}`,JSON.stringify(i.data.timings)),console.log("Prayer times fetched successfully and cached"),o(i.data.timings)}catch(t){console.error("Error fetching prayer times:",t);const e={Fajr:"05:30",Dhuhr:"12:00",Asr:"15:30",Maghrib:"18:00",Isha:"19:30"};console.log("Using fallback prayer times"),o(e)}}function o(t){document.getElementById("fajr-time")&&(document.getElementById("fajr-time").textContent=t.Fajr),document.getElementById("dhuhr-time")&&(document.getElementById("dhuhr-time").textContent=t.Dhuhr),document.getElementById("asr-time")&&(document.getElementById("asr-time").textContent=t.Asr),document.getElementById("maghrib-time")&&(document.getElementById("maghrib-time").textContent=t.Maghrib),document.getElementById("isha-time")&&(document.getElementById("isha-time").textContent=t.Isha),document.getElementById("jumuah-time")&&(document.getElementById("jumuah-time").textContent="12:20")}document.querySelector(".prayer-times")&&r();const c=document.getElementById("surah-select"),i=document.getElementById("toggle-arabic"),l=document.getElementById("toggle-translation"),s=document.getElementById("toggle-transliteration"),d=document.getElementById("arabic-text"),g=document.getElementById("english-text"),h=document.getElementById("transliteration-text");if(c&&i&&l&&s&&d&&g&&h){const t={},e=async()=>{try{const t=localStorage.getItem("surah_list");if(t)return void a(JSON.parse(t));const e=new AbortController,n=setTimeout(()=>e.abort(),5e3),r=await fetch("https://api.alquran.cloud/v1/surah",{signal:e.signal});if(clearTimeout(n),!r.ok)throw new Error("Failed to fetch surah list");const o=await r.json();localStorage.setItem("surah_list",JSON.stringify(o)),a(o)}catch(t){console.error("Error fetching surah list:",t),c.innerHTML='<option value="">Failed to load surahs. Please try again later.</option>'}},a=t=>{for(;c.options.length>1;)c.remove(1);t.data.forEach(t=>{const e=document.createElement("option");e.value=t.number,e.textContent=`${t.number}. ${t.englishName} (${t.name})`,c.appendChild(e)})};e(),c.addEventListener("change",async function(){const t=this.value;if(!t)return;d.innerHTML="<p>Loading Arabic text...</p>",g.innerHTML="<p>Loading English translation...</p>",h.innerHTML="<p>Loading transliteration...</p>";try{const e=async(t,e,a)=>{const n=localStorage.getItem(a);if(n)return void r(JSON.parse(n),e);const o=new AbortController,c=setTimeout(()=>o.abort(),8e3);try{const i=await fetch(t,{signal:o.signal});if(clearTimeout(c),!i.ok)throw new Error(`Error fetching from ${t}`);const l=await i.json();localStorage.setItem(a,JSON.stringify(l)),r(l,e)}catch(t){console.error(`Error fetching ${a}:`,t),e.innerHTML="<p>Failed to load text. Please try again later.</p>"}},a=t=>{t.data.ayahs.forEach(t=>{const e=document.createElement("p");e.textContent=`${t.text} (${t.numberInSurah})`,a.appendChild(e)})};let n=t;const r=(t,e)=>{e.innerHTML="",t.data.ayahs.forEach(t=>{const a=document.createElement("p");a.textContent=`${t.text} (${t.numberInSurah})`,e.appendChild(a)})};await Promise.all([e(`https://api.alquran.cloud/v1/surah/${n}`,d,`arabic_surah_${n}`),e(`https://api.alquran.cloud/v1/surah/${n}/en.sahih`,g,`english_surah_${n}`),e(`https://api.alquran.cloud/v1/surah/${n}/en.transliteration`,h,`transliteration_surah_${n}`)]),d.style.display="block",i.textContent="Hide Arabic Text"}catch(t){console.error("Error loading surah:",t)}});const n=(t,e,a,n)=>{t.addEventListener("click",function(){const t="none"===e.style.display||""===e.style.display;e.style.display=t?"block":"none",this.textContent=t?n:a},{passive:!0})};n(i,d,"Show Arabic Text","Hide Arabic Text"),n(l,g,"Show English Translation","Hide English Translation"),n(s,h,"Show Transliteration","Hide Transliteration")}"IntersectionObserver"in window&&new IntersectionObserver((t,e)=>{t.forEach(t=>{if(t.isIntersecting){const a=t.target,n=a.getAttribute("data-src");n&&(a.src=n,a.removeAttribute("data-src")),e.unobserve(a)}})}).observe(...document.querySelectorAll("img[data-src]"));const m=document.querySelectorAll(".gallery-video");m.forEach(t=>{t.muted=!0,t.addEventListener("click",()=>{t.paused?(m.forEach(e=>{e!==t&&!e.paused&&e.pause()}),t.play().catch(t=>console.error("Video play error:",t))):t.pause()},{passive:!0}),t.addEventListener("error",function(){console.error("Video error:",this.error),this.insertAdjacentHTML("afterend",'<p class="video-error">Video could not be loaded. Please try again later.</p>')})});const u=document.getElementById("gallery-filter"),p=document.getElementById("gallery-videos"),y=document.getElementById("gallery-images");u&&p&&y?(u.addEventListener("change",function(){const t=this.value;requestAnimationFrame(()=>{"videos"===t?(p.classList.remove("hidden"),y.classList.add("hidden")):"images"===t?(p.classList.add("hidden"),y.classList.remove("hidden")):(p.classList.remove("hidden"),y.classList.remove("hidden"))})},{passive:!0}),p.classList.remove("hidden"),y.classList.remove("hidden")):function(){try{const t=new Date;for(let e=0;e<localStorage.length;e++){const a=localStorage.key(e);if(a&&a.startsWith("prayer_times_")){const e=a.replace("prayer_times_",""),n=new Date(e);Math.floor((t-n)/864e5)>7&&localStorage.removeItem(a)}}const e=localStorage.getItem("quran_cache_timestamp");if(!e||Date.now()-parseInt(e)>2592e6){for(let t=0;t<localStorage.length;t++){const e=localStorage.key(t);e&&(e.startsWith("arabic_surah_")||e.startsWith("english_surah_")||e.startsWith("transliteration_surah_"))&&localStorage.removeItem(e)}localStorage.setItem("quran_cache_timestamp",Date.now())}}catch(t){console.error("Error cleaning cache:",t)}}();

// Education page specific script
// Tab functionality with null checks
const safeQuery = (selector, callback) => {
    const elements = document.querySelectorAll(selector);
    if (elements && elements.length > 0) {
        elements.forEach(callback);
    }
};

// Tab functionality for prayer guide
safeQuery('.guide-tab', tab => {
    tab.addEventListener('click', function() {
        const tabId = this.getAttribute('data-tab');
        
        // Only proceed if we find the elements
        const tabs = document.querySelectorAll('.guide-tab');
        const contents = document.querySelectorAll('.guide-content');
        
        if (tabs && contents) {
            // Remove active class from all tabs and contents
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            // Add active class to current tab
            this.classList.add('active');
            
            // Find the content and add active class if it exists
            const content = document.getElementById(tabId);
            if (content) {
                content.classList.add('active');
            }
        }
    });
});

// Collapsible sections
safeQuery('.collapsible-header', collapsible => {
    collapsible.addEventListener('click', function() {
        if (this.parentElement) {
            this.parentElement.classList.toggle('active');
        }
    });
});

// Handle anchor links for tabs
if (window.location.hash) {
    const hash = window.location.hash.substring(1);
    const tabButton = document.querySelector(`.guide-tab[data-tab="${hash}"]`);
    if (tabButton) {
        tabButton.click();
    }
}

document.querySelectorAll(".social-media a").forEach(t=>{"Facebook"===t.textContent&&(t.href="https://www.facebook.com/profile.php?id=100081668231878",t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer"))});const f='\n        <div id="fb-live-notification" class="fb-live-notification" style="display: none;">\n            <div class="notification-content">\n                <span class="live-icon">ðŸ”´ LIVE</span>\n                <span class="notification-message">We\'re live now. Join us for Taraweeh prayers</span>\n                <a href="https://www.facebook.com/profile.php?id=100081668231878" target="_blank" rel="noopener noreferrer" class="notification-link">Join us</a>\n                <button class="notification-close" aria-label="Close notification">Ã—</button>\n            </div>\n        </div>\n    ';document.body.insertAdjacentHTML("afterbegin",f);const v=document.createElement("style");v.textContent='\n        .fb-live-notification {\n            position: fixed;\n            top: 100px;\n            right: 20px;\n            background: var(--primary-color);\n            color: white;\n            padding: 0.8rem 1rem;\n            border-radius: 10px;\n            box-shadow: 0 4px 15px var(--shadow-color);\n            z-index: 9999;\n            max-width: 300px;\n            animation: slideInRight 0.5s ease-out;\n            transform-origin: top right;\n        }\n        \n        .notification-content {\n            display: flex;\n            align-items: center;\n            flex-wrap: wrap;\n            gap: 0.5rem;\n        }\n        \n        .live-icon {\n            font-weight: bold;\n            display: inline-flex;\n            align-items: center;\n        }\n        \n        .notification-link {\n            background: rgba(255, 255, 255, 0.2);\n            color: white;\n            padding: 0.3rem 0.8rem;\n            border-radius: 15px;\n            text-decoration: none;\n            font-size: 0.8rem;\n            transition: background 0.3s ease;\n        }\n        \n        .notification-link:hover {\n            background: rgba(255, 255, 255, 0.3);\n        }\n        \n        .notification-close {\n            background: transparent;\n            border: none;\n            color: white;\n            font-size: 1.2rem;\n            cursor: pointer;\n            margin-left: auto;\n            padding: 0;\n            line-height: 1;\n        }\n        \n        @keyframes slideInRight {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n        }\n        \n        .dark-theme .fb-live-notification {\n            background: var(--secondary-color);\n        }\n        \n        @media (max-width: 480px) {\n            .fb-live-notification {\n                top: 80px;\n                right: 10px;\n                left: 10px;\n                max-width: none;\n            }\n        }\n    ',document.head.appendChild(v);const b=document.querySelector(".notification-close");function E(t){const e=document.getElementById("fb-live-notification");if(!e)return;const a="true"===sessionStorage.getItem("fbLiveNotificationClosed");t&&!a?(e.style.display="block",console.log("Live notification shown")):(e.style.display="none",console.log("Live notification hidden"))}function I(){fetch("fb-live-status.json").then(t=>t.json()).then(t=>{t.isLive?E(!0):w()}).catch(t=>{console.error("Error checking live status:",t),w()})}function w(){const t=new Date,e=t.getHours(),a=t.getMinutes(),n=19===e&&a>=35||20===e&&a<15;console.log("Time check:",e+":"+a,"Is Taraweeh live hour:",n),n?E(!0):(E(!1),console.log("Taraweeh live notification should be showing (by schedule)"))}function k(){const t=new URLSearchParams(window.location.search),e=t.get("showLive");if("true"===e)return E(!0),void console.log("Live notification forced via URL param");if("false"===e)return E(!1),void console.log("Live notification disabled via URL param");I()}b&&b.addEventListener("click",function(){document.getElementById("fb-live-notification").style.display="none",sessionStorage.setItem("fbLiveNotificationClosed","true")},{passive:!0}),k(),setInterval(k,6e4),console.log("DOMContentLoaded: All main functionality initialized")});

// Additional gallery.js content
document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("gallery-main-filter"),t=document.getElementById("gallery-videos"),a=document.getElementById("gallery-images");e&&t&&a&&e.addEventListener("change",function(){const e=this.value;requestAnimationFrame(()=>{"videos"===e?(t.style.display="block",a.style.display="none"):"images"===e?(t.style.display="none",a.style.display="block"):(t.style.display="block",a.style.display="block")})},{passive:!0});const n=document.querySelectorAll(".filter-button"),i=document.querySelectorAll(".video-card");n.forEach(e=>{e.addEventListener("click",function(){n.forEach(e=>e.classList.remove("active")),this.classList.add("active");const t=this.getAttribute("data-filter");i.forEach(e=>{"all"===t||e.getAttribute("data-category")===t?e.style.display="block":e.style.display="none"})},{passive:!0})});const o=document.getElementById("video-modal"),s=document.getElementById("modal-video"),r=document.querySelector(".modal-close"),d=document.querySelectorAll(".video-thumbnail");d.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-video"),t=s.querySelector("source");t.src=e,s.load(),o.style.display="flex",s.play().catch(e=>{console.log("Autoplay prevented by browser. Click to play.")})})}),r&&r.addEventListener("click",function(){s.pause(),o.style.display="none"}),o&&o.addEventListener("click",function(e){e.target===o&&(s.pause(),o.style.display="none")}),document.addEventListener("keydown",function(e){if("Escape"===e.key){const e=document.getElementById("image-preview-modal");e&&(e.style.display="none"),o&&(s.pause(),o.style.display="none")}}),d.forEach(e=>{const t=e.querySelector("img");t.addEventListener("error",function(){this.src="data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22288%22%20height%3D%22162%22%20viewBox%3D%220%200%20288%20162%22%3E%3Crect%20fill%3D%22%23465362%22%20width%3D%22288%22%20height%3D%22162%22%2F%3E%3Ctext%20fill%3D%22%23FFFFFF%22%20font-family%3D%22sans-serif%22%20font-size%3D%2214%22%20x%3D%22144%22%20y%3D%2281%22%20text-anchor%3D%22middle%22%3EVideo%20Thumbnail%3C%2Ftext%3E%3C%2Fsvg%3E",this.alt="Video Thumbnail"})})});